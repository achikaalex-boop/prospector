import{c as b,a as v}from"./paypal-2c0BkHnn.js";import{c as n,e as t,b as d,A as u,z as c,aM as h,aN as y,D as x,t as m,J as g,o as i}from"./index-Cm5piLp0.js";import{_ as f}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-B9ygI19o.js";const k={name:"TopUp",data(){return{amount:10,currency:"USD",order:null,approvalLink:null,message:"",showRedirectModal:!1,isLoading:!1}},methods:{presetClass(s){return this.amount===s?"bg-blue-600 text-white":"bg-gray-100 text-gray-800"},selectPreset(s){this.amount=s},goBack(){this.$router.push("/")},async startTopup(){this.message="",this.isLoading=!0;try{const s=Math.round(Number(this.amount||0)*100);if(s<=0){this.message="Montant invalide",this.isLoading=!1;return}let e=null;try{const{data:{session:a}}=await g.auth.getSession();e=a?.user?.id||null}catch{}const l=await v(s,this.currency,`Top-up ${this.amount} ${this.currency}`);this.order=l;const p=(l?.links||[]).find(a=>a.rel==="approve");this.approvalLink=p?p.href:null,this.approvalLink||(this.message="Order créé, mais aucun lien d'approbation trouvé."),this.showRedirectModal=!0}catch(s){console.error(s),this.message=`Erreur: ${s?.response?.data?.error||s.message||s}`}finally{this.isLoading=!1}},async capture(){this.message="";try{if(!this.order||!this.order.id)return this.message="Aucune order à capturer.";let s=null;try{const{data:{session:l}}=await g.auth.getSession();s=l?.user?.id||null}catch{}const e=await b(this.order.id,s);this.message="Paiement capturé avec succès.",this.order=e,this.approvalLink=null;try{window.dispatchEvent(new CustomEvent("balance:updated"))}catch{}this.showRedirectModal=!1,this.$router.push("/pricing")}catch(s){console.error(s),this.message=`Erreur lors de la capture: ${s?.response?.data?.error||s.message||s}`}},openApprovalFromModal(){this.approvalLink&&(window.open(this.approvalLink,"_blank"),this.showRedirectModal=!1)},cancelRedirect(){this.showRedirectModal=!1}}},w={class:"p-6 max-w-lg mx-auto"},C={class:"bg-white shadow rounded-lg p-6"},P={class:"grid grid-cols-4 gap-3 mb-4"},M={class:"mb-4"},L={class:"flex gap-2"},_={class:"flex items-center gap-3"},R={key:0,class:"mt-4 border rounded bg-gray-50 p-3"},U={class:"text-sm text-gray-700"},z={key:0,class:"mt-2"},A=["href"],D={class:"mt-2"},S={key:1,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40"},T={class:"bg-white rounded-lg p-6 w-full max-w-md"},B={class:"flex items-center gap-3"},O={key:0,class:"ml-auto text-sm text-gray-600"},V={key:2,class:"mt-4 text-sm text-red-600"};function E(s,e,l,p,a,r){return i(),n("div",w,[t("div",C,[e[16]||(e[16]=t("h2",{class:"text-2xl font-semibold mb-2"},"Ajouter des fonds",-1)),e[17]||(e[17]=t("p",{class:"text-sm text-gray-600 mb-4"},"Choisissez un montant ou entrez un montant personnalisé.",-1)),t("div",P,[t("button",{onClick:e[0]||(e[0]=o=>r.selectPreset(5)),class:u([r.presetClass(5),"py-2 rounded"])},"$5",2),t("button",{onClick:e[1]||(e[1]=o=>r.selectPreset(10)),class:u([r.presetClass(10),"py-2 rounded"])},"$10",2),t("button",{onClick:e[2]||(e[2]=o=>r.selectPreset(25)),class:u([r.presetClass(25),"py-2 rounded"])},"$25",2),t("button",{onClick:e[3]||(e[3]=o=>r.selectPreset(50)),class:u([r.presetClass(50),"py-2 rounded"])},"$50",2)]),t("div",M,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Montant (USD)",-1)),t("div",L,[c(t("input",{"onUpdate:modelValue":e[4]||(e[4]=o=>a.amount=o),type:"number",min:"1",class:"flex-1 block w-full border rounded px-3 py-2"},null,512),[[h,a.amount,void 0,{number:!0}]]),c(t("select",{"onUpdate:modelValue":e[5]||(e[5]=o=>a.currency=o),class:"border rounded px-2 py-2"},[...e[11]||(e[11]=[t("option",{value:"USD"},"USD",-1)])],512),[[y,a.currency]])])]),t("div",_,[t("button",{onClick:e[6]||(e[6]=(...o)=>r.startTopup&&r.startTopup(...o)),class:"bg-blue-600 text-white px-4 py-2 rounded shadow"},"Payer avec PayPal"),t("button",{onClick:e[7]||(e[7]=(...o)=>r.goBack&&r.goBack(...o)),class:"text-sm text-gray-600"},"Annuler")]),a.order?(i(),n("div",R,[t("div",U,[e[13]||(e[13]=x("Order ID: ",-1)),t("strong",null,m(a.order.id),1)]),a.approvalLink?(i(),n("div",z,[t("a",{href:a.approvalLink,target:"_blank",class:"text-blue-600"},"Ouvrir le lien d'approbation PayPal",8,A)])):d("",!0),t("div",D,[t("button",{onClick:e[8]||(e[8]=(...o)=>r.capture&&r.capture(...o)),class:"bg-green-600 text-white px-3 py-1 rounded"},"J'ai payé — Capturer")])])):d("",!0),a.showRedirectModal?(i(),n("div",S,[t("div",T,[e[14]||(e[14]=t("h3",{class:"text-lg font-semibold mb-2"},"Redirection vers PayPal",-1)),e[15]||(e[15]=t("p",{class:"text-sm text-gray-700 mb-4"},"Vous allez être redirigé vers PayPal pour autoriser le paiement. Une fois approuvé, revenez ici pour finaliser la capture ou utilisez la page de confirmation.",-1)),t("div",B,[t("button",{onClick:e[9]||(e[9]=(...o)=>r.openApprovalFromModal&&r.openApprovalFromModal(...o)),class:"bg-blue-600 text-white px-4 py-2 rounded"},"Ouvrir PayPal"),t("button",{onClick:e[10]||(e[10]=(...o)=>r.cancelRedirect&&r.cancelRedirect(...o)),class:"px-4 py-2 border rounded"},"Annuler"),a.isLoading?(i(),n("div",O,"Chargement...")):d("",!0)])])])):d("",!0),a.message?(i(),n("div",V,m(a.message),1)):d("",!0)])])}const J=f(k,[["render",E],["__scopeId","data-v-9d4b29e7"]]);export{J as default};
