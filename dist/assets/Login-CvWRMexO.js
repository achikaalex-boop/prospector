import{a as o}from"./index-B9ygI19o.js";import{c as d,e as t,x as l,b as u,aL as m,t as c,o as p}from"./index-4MemwKCE.js";import{_ as f}from"./_plugin-vue_export-helper-DlAUqK2U.js";const h={name:"AdminLogin",data(){return{email:"",password:"",isLoading:!1,error:null}},methods:{async submit(){try{this.isLoading=!0,this.error=null;const s=await o.post("/api/admin/login",{email:this.email,password:this.password});if(s.data&&s.data.ok&&s.data.token){const e=s.data.token;localStorage.setItem("admin_token",e),o.defaults.headers.common["x-admin-token"]=e,this.$router.push({name:"AdminPlans"})}else this.error="Échec de la connexion"}catch(s){this.error=s?.response?.data?.error||s.message||String(s)}finally{this.isLoading=!1}},async initIfNeeded(){try{this.isLoading=!0,this.error=null,console.log("Attempting to initialize admin credentials");const s=await o.post("/api/admin/set-admin-credentials",{email:this.email||"admin@localhost",password:this.password||"admin"});if(s.data&&s.data.ok){this.$toast.add({severity:"success",summary:"Initialisé",detail:"Identifiants administrateur créés",life:4e3});try{const e=await o.post("/api/admin/login",{email:this.email||"admin@localhost",password:this.password||"admin"});if(e.data&&e.data.ok&&e.data.token){const r=e.data.token;localStorage.setItem("admin_token",r),o.defaults.headers.common["x-admin-token"]=r,this.$router.push({name:"AdminPlans"})}else this.$toast.add({severity:"info",summary:"Initialisé",detail:"Identifiants créés. Connectez-vous manuellement.",life:5e3})}catch(e){console.error("Auto-login failed",e),this.$toast.add({severity:"info",summary:"Initialisé",detail:"Identifiants créés mais auto-login impossible. Connectez-vous manuellement.",life:6e3}),this.error=e?.response?.data?.error||e.message||String(e)}}else this.error="Impossible d'initialiser",console.warn("set-admin-credentials returned unexpected response",s)}catch(s){console.error("initIfNeeded error",s),this.error=s?.response?.data?.error||s.message||String(s),this.$toast.add({severity:"error",summary:"Erreur",detail:this.error,life:6e3})}finally{this.isLoading=!1}}}},g={class:"p-6 max-w-md mx-auto"},x={class:"bg-white p-4 rounded shadow"},b={class:"flex gap-2"},w=["disabled"],y=["disabled"],k={key:0,class:"text-red-600 mt-3"};function I(s,e,r,v,i,n){return p(),d("div",g,[e[7]||(e[7]=t("h1",{class:"text-2xl font-bold mb-4"},"Admin — Connexion",-1)),t("div",x,[e[4]||(e[4]=t("label",{class:"text-xs"},"Email",-1)),l(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>i.email=a),class:"w-full p-2 border rounded mb-2",placeholder:"admin@example.com"},null,512),[[m,i.email]]),e[5]||(e[5]=t("label",{class:"text-xs"},"Mot de passe",-1)),l(t("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>i.password=a),type:"password",class:"w-full p-2 border rounded mb-4"},null,512),[[m,i.password]]),t("div",b,[t("button",{onClick:e[2]||(e[2]=(...a)=>n.submit&&n.submit(...a)),disabled:i.isLoading,class:"bg-blue-600 text-white px-4 py-2 rounded"},"Connexion",8,w),t("button",{onClick:e[3]||(e[3]=(...a)=>n.initIfNeeded&&n.initIfNeeded(...a)),disabled:i.isLoading,class:"px-4 py-2 border rounded"},"Initialiser (si non configuré)",8,y)]),i.error?(p(),d("p",k,c(i.error),1)):u("",!0),e[6]||(e[6]=t("p",{class:"text-xs text-gray-500 mt-3"},"Si l'admin n'est pas initialisé, utilisez le bouton 'Initialiser' pour créer les identifiants.",-1))])])}const _=f(h,[["render",I]]);export{_ as default};
