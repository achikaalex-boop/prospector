import{a as m}from"./index-B9ygI19o.js";import{c as i,e as t,F as _,I as b,t as c,J as u,o as l}from"./index-DMcYmbUg.js";import{_ as h}from"./_plugin-vue_export-helper-DlAUqK2U.js";const p={name:"Pricing",data(){return{uiPlans:[{slug:"free",name:"Starter",monthly_price:0,per_min_cents:17,concurrency:5},{slug:"standard",name:"Standard",monthly_price:19,per_min_cents:15,concurrency:10},{slug:"pro",name:"Pro",monthly_price:49,per_min_cents:12,concurrency:20}],balanceCents:0,balanceLoading:!0}},async created(){await this.fetchBalance()},methods:{async fetchBalance(){this.balanceLoading=!0;try{let n=null;try{const{data:{session:a}}=await u.auth.getSession();n=a?.user?.id||null}catch{}if(!n){this.balanceCents=0,this.balanceLoading=!1;return}const{data:e,error:d}=await u.from("user_credits").select("amount").eq("user_id",n);if(!d&&Array.isArray(e)){const a=e.reduce((r,o)=>r+(Number(o.amount)||0),0);this.balanceCents=Math.round(a*100)}else this.balanceCents=0}catch(n){console.error("Could not fetch balance",n),this.balanceCents=0}finally{this.balanceLoading=!1}},async subscribe(n){try{let e=null;try{const{data:{session:s}}=await u.auth.getSession();e=s?.user?.id||null}catch{}const d=Math.round(n.monthly_price*100),o=((await m.post("/api/subscribe",{plan_slug:n.slug,amount_cents:d,user_id:e})).data?.links||[]).find(s=>s.rel==="approve");o?window.location.href=o.href:alert("Impossible d'obtenir le lien PayPal d'approbation")}catch(e){console.error("subscribe error",e),alert("Erreur lors de la création de la souscription: "+(e?.response?.data?.error||e.message||e))}}}},y={class:"p-6 max-w-3xl mx-auto"},f={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},g={class:"text-xl font-semibold"},x={class:"mt-2"},v={class:"mt-1"},C={class:"mt-1"},k={class:"mt-3"},w=["onClick"],P={class:"mt-6"},S={key:0},L={key:1,class:"text-lg"};function B(n,e,d,a,r,o){return l(),i("div",y,[e[1]||(e[1]=t("h1",{class:"text-3xl font-bold mb-4"},"Abonnements",-1)),e[2]||(e[2]=t("div",{class:"mb-4 text-sm text-gray-600"},"Choisissez un abonnement. Les appels sont facturés à la minute en plus si applicable.",-1)),t("div",f,[(l(!0),i(_,null,b(r.uiPlans,s=>(l(),i("div",{key:s.slug,class:"border p-4 rounded"},[t("h3",g,c(s.name),1),t("div",x,"Prix: $"+c(s.monthly_price.toFixed(2))+" / mois",1),t("div",v,"Concurrency: "+c(s.concurrency)+" appels simultanés",1),t("div",C,"Per-minute estimé: "+c(s.per_min_cents)+" cents",1),t("div",k,[t("button",{onClick:F=>o.subscribe(s),class:"bg-blue-600 text-white px-3 py-2 rounded"},"S'abonner",8,w)])]))),128))]),t("div",P,[e[0]||(e[0]=t("h2",{class:"text-xl font-semibold mb-2"},"Solde",-1)),r.balanceLoading?(l(),i("div",S,"Chargement du solde...")):(l(),i("div",L,c((r.balanceCents/100).toFixed(2))+" USD",1))])])}const I=h(p,[["render",B]]);export{I as default};
