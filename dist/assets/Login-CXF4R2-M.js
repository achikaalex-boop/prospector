import{a as n}from"./index-B9ygI19o.js";import{c as r,e as i,x as d,b as p,aL as l,t as u,o as m}from"./index-Dsp5A8uu.js";import{_ as c}from"./_plugin-vue_export-helper-DlAUqK2U.js";const f={name:"AdminLogin",data(){return{email:"",password:"",isLoading:!1,error:null}},methods:{async submit(){try{this.isLoading=!0,this.error=null;const e=await n.post("/api/admin/login",{email:this.email,password:this.password});if(e.data&&e.data.ok&&e.data.token){const s=e.data.token;localStorage.setItem("admin_token",s),n.defaults.headers.common["x-admin-token"]=s,this.$router.push({name:"AdminPlans"})}else this.error="Échec de la connexion"}catch(e){this.error=e?.response?.data?.error||e.message||String(e)}finally{this.isLoading=!1}},async initIfNeeded(){try{this.isLoading=!0,this.error=null;const e=await n.post("/api/admin/set-admin-credentials",{email:this.email||"admin@localhost",password:this.password||"admin"});e.data&&e.data.ok?this.$toast.add({severity:"success",summary:"Initialisé",detail:"Identifiants administrateur créés",life:4e3}):this.error="Impossible d'initialiser"}catch(e){this.error=e?.response?.data?.error||e.message||String(e)}finally{this.isLoading=!1}}}},x={class:"p-6 max-w-md mx-auto"},b={class:"bg-white p-4 rounded shadow"},g={class:"flex gap-2"},h=["disabled"],w=["disabled"],y={key:0,class:"text-red-600 mt-3"};function k(e,s,L,I,t,a){return m(),r("div",x,[s[7]||(s[7]=i("h1",{class:"text-2xl font-bold mb-4"},"Admin — Connexion",-1)),i("div",b,[s[4]||(s[4]=i("label",{class:"text-xs"},"Email",-1)),d(i("input",{"onUpdate:modelValue":s[0]||(s[0]=o=>t.email=o),class:"w-full p-2 border rounded mb-2",placeholder:"admin@example.com"},null,512),[[l,t.email]]),s[5]||(s[5]=i("label",{class:"text-xs"},"Mot de passe",-1)),d(i("input",{"onUpdate:modelValue":s[1]||(s[1]=o=>t.password=o),type:"password",class:"w-full p-2 border rounded mb-4"},null,512),[[l,t.password]]),i("div",g,[i("button",{onClick:s[2]||(s[2]=(...o)=>a.submit&&a.submit(...o)),disabled:t.isLoading,class:"bg-blue-600 text-white px-4 py-2 rounded"},"Connexion",8,h),i("button",{onClick:s[3]||(s[3]=(...o)=>a.initIfNeeded&&a.initIfNeeded(...o)),disabled:t.isLoading,class:"px-4 py-2 border rounded"},"Initialiser (si non configuré)",8,w)]),t.error?(m(),r("p",y,u(t.error),1)):p("",!0),s[6]||(s[6]=i("p",{class:"text-xs text-gray-500 mt-3"},"Si l'admin n'est pas initialisé, utilisez le bouton 'Initialiser' pour créer les identifiants.",-1))])])}const N=c(f,[["render",k]]);export{N as default};
