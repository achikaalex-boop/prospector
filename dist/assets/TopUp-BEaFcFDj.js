import{c as v,a as h}from"./paypal-2c0BkHnn.js";import{c as i,e as r,b as u,z as b,aM as g,D as d,t as m,J as c,o as l}from"./index-DMcYmbUg.js";import{_ as k}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-B9ygI19o.js";const f={name:"TopUp",data(){return{amount:5,order:null,approvalLink:null,message:""}},methods:{async startTopup(){this.message="";try{const t=Math.round(Number(this.amount||0)*100);if(t<=0)return this.message="Montant invalide";let e=null;try{const{data:{session:s}}=await c.auth.getSession();e=s?.user?.id||null}catch{}const a=await h(t,"USD",`Top-up ${this.amount} USD`);this.order=a;const p=(a?.links||[]).find(s=>s.rel==="approve");this.approvalLink=p?p.href:null,this.approvalLink||(this.message="Order créé, mais aucun lien d'approbation trouvé.")}catch(t){console.error(t),this.message=`Erreur: ${t?.response?.data?.error||t.message||t}`}},openApproval(){this.approvalLink&&window.open(this.approvalLink,"_blank")},async capture(){this.message="";try{if(!this.order||!this.order.id)return this.message="Aucune order à capturer.";let t=null;try{const{data:{session:a}}=await c.auth.getSession();t=a?.user?.id||null}catch{}const e=await v(this.order.id,t);this.message="Paiement capturé avec succès.",this.order=e,this.approvalLink=null}catch(t){console.error(t),this.message=`Erreur lors de la capture: ${t?.response?.data?.error||t.message||t}`}}}},x={class:"p-6 max-w-md mx-auto"},y={class:"mb-4"},_={class:"flex gap-2"},w=["disabled"],L={key:0,class:"mt-4 bg-gray-50 border p-3 rounded"},T={key:0},D=["href"],S={class:"mt-2"},U={key:1,class:"mt-4 text-sm text-gray-700"};function A(t,e,a,p,s,n){return l(),i("div",x,[e[7]||(e[7]=r("h2",{class:"text-2xl font-semibold mb-4"},"Top-up de crédit",-1)),r("div",y,[e[4]||(e[4]=r("label",{class:"block text-sm font-medium"},"Montant (USD)",-1)),b(r("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>s.amount=o),type:"number",min:"1",class:"mt-1 block w-full border rounded px-2 py-1"},null,512),[[g,s.amount,void 0,{number:!0}]])]),r("div",_,[r("button",{onClick:e[1]||(e[1]=(...o)=>n.startTopup&&n.startTopup(...o)),class:"bg-blue-600 text-white px-4 py-2 rounded"},"Payer"),r("button",{onClick:e[2]||(e[2]=(...o)=>n.openApproval&&n.openApproval(...o)),disabled:!s.approvalLink,class:"bg-gray-200 px-4 py-2 rounded"},"Ouvrir l'approbation",8,w)]),s.order?(l(),i("div",L,[r("div",null,[e[5]||(e[5]=r("strong",null,"Order:",-1)),d(" "+m(s.order.id),1)]),s.approvalLink?(l(),i("div",T,[e[6]||(e[6]=d("Approval link: ",-1)),r("a",{href:s.approvalLink,target:"_blank",class:"text-blue-600"},"ouvrir",8,D)])):u("",!0),r("div",S,[r("button",{onClick:e[3]||(e[3]=(...o)=>n.capture&&n.capture(...o)),class:"bg-green-600 text-white px-3 py-1 rounded"},"J'ai payé — Capturer")])])):u("",!0),s.message?(l(),i("div",U,m(s.message),1)):u("",!0)])}const V=k(f,[["render",A],["__scopeId","data-v-170a11e1"]]);export{V as default};
